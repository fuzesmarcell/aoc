/*
 * Advent of code common code
 *
 *
 * File      day_03.c
 * Author    Fuzes Marcell
 * Date      2021.12.03
 */

#include <assert.h>
#include <inttypes.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <aoc.h>

typedef int32_t bool32;

typedef struct {
  bool32 removed;
  uint16_t value;
} bit_entry_t;

#define MAX_ENTRIES (2000)

typedef struct {
  // the amount of valid bits in the entries
  int no_bits;
  int mask;

  // number of entries not removed
  int count;

  // number of entries either removed or not
  int len;
  bit_entry_t entries[MAX_ENTRIES];
} bit_array_t;

bit_array_t create_bit_array(void) {
  bit_entry_t diagnostics[] = {
      {false, 0b001001100101},
      {false, 0b010100011100},
      {false, 0b100000110001},
      {false, 0b001111110101},
      {false, 0b100010110101},
      {false, 0b111010100100},
      {false, 0b011011000110},
      {false, 0b100000011101},
      {false, 0b011001100111},
      {false, 0b000001011110},
      {false, 0b000010100011},
      {false, 0b110100111110},
      {false, 0b001101100101},
      {false, 0b011011011101},
      {false, 0b010000011010},
      {false, 0b011100100100},
      {false, 0b001111000011},
      {false, 0b100111000111},
      {false, 0b100111100011},
      {false, 0b101100011011},
      {false, 0b001110101101},
      {false, 0b110010101000},
      {false, 0b111110110111},
      {false, 0b111100100010},
      {false, 0b001001000000},
      {false, 0b001111101011},
      {false, 0b101100110011},
      {false, 0b011010001111},
      {false, 0b100010100001},
      {false, 0b110011001010},
      {false, 0b101000001100},
      {false, 0b111010101100},
      {false, 0b101010101100},
      {false, 0b110011101000},
      {false, 0b001110010110},
      {false, 0b010101001001},
      {false, 0b000010101100},
      {false, 0b010101101010},
      {false, 0b111001101100},
      {false, 0b010000000000},
      {false, 0b011011111000},
      {false, 0b001110110011},
      {false, 0b101000001011},
      {false, 0b110101100101},
      {false, 0b111001010111},
      {false, 0b110001111111},
      {false, 0b010010100110},
      {false, 0b011010011001},
      {false, 0b011101100000},
      {false, 0b100110010101},
      {false, 0b111000101101},
      {false, 0b110011110000},
      {false, 0b011001011000},
      {false, 0b001101000010},
      {false, 0b001110011111},
      {false, 0b100010101100},
      {false, 0b010011100101},
      {false, 0b000011110000},
      {false, 0b101100001111},
      {false, 0b010001011000},
      {false, 0b001101011101},
      {false, 0b011110001110},
      {false, 0b111110101101},
      {false, 0b010000000011},
      {false, 0b111000000011},
      {false, 0b000100010100},
      {false, 0b111110011001},
      {false, 0b111001010011},
      {false, 0b011000100010},
      {false, 0b100001110000},
      {false, 0b111111000100},
      {false, 0b010100101110},
      {false, 0b010011100110},
      {false, 0b101100110111},
      {false, 0b101001101001},
      {false, 0b000001110111},
      {false, 0b101100000001},
      {false, 0b011010111011},
      {false, 0b110011011111},
      {false, 0b001001011001},
      {false, 0b010110101100},
      {false, 0b001100101100},
      {false, 0b101001011101},
      {false, 0b100101000010},
      {false, 0b010101000010},
      {false, 0b111101011110},
      {false, 0b000000100010},
      {false, 0b111010010010},
      {false, 0b100001111011},
      {false, 0b110000010011},
      {false, 0b000101111001},
      {false, 0b111101100111},
      {false, 0b110101011100},
      {false, 0b000111110101},
      {false, 0b011110111001},
      {false, 0b010000101011},
      {false, 0b001001011000},
      {false, 0b010110011100},
      {false, 0b111111111000},
      {false, 0b110100000101},
      {false, 0b110101010011},
      {false, 0b010011110010},
      {false, 0b100110111100},
      {false, 0b111000001101},
      {false, 0b110001001001},
      {false, 0b111101111100},
      {false, 0b111111101001},
      {false, 0b100101001010},
      {false, 0b010101010100},
      {false, 0b010010001111},
      {false, 0b000010110000},
      {false, 0b011001110110},
      {false, 0b111101111011},
      {false, 0b011001011100},
      {false, 0b110101010101},
      {false, 0b110111011111},
      {false, 0b110101111000},
      {false, 0b110010100110},
      {false, 0b110000000010},
      {false, 0b011001100001},
      {false, 0b011000110010},
      {false, 0b010110100000},
      {false, 0b011110000001},
      {false, 0b100101011010},
      {false, 0b100111111011},
      {false, 0b001110000011},
      {false, 0b100110011011},
      {false, 0b000100011101},
      {false, 0b110000110110},
      {false, 0b000001000010},
      {false, 0b011111111010},
      {false, 0b001010100100},
      {false, 0b011000100100},
      {false, 0b001100001111},
      {false, 0b010111100111},
      {false, 0b010001101101},
      {false, 0b011001010000},
      {false, 0b001010101000},
      {false, 0b001001100011},
      {false, 0b000011001010},
      {false, 0b010010010100},
      {false, 0b100001011000},
      {false, 0b000011011011},
      {false, 0b111011110111},
      {false, 0b100010010000},
      {false, 0b111001110000},
      {false, 0b011100010100},
      {false, 0b000101101011},
      {false, 0b010000000010},
      {false, 0b001101110100},
      {false, 0b111010111111},
      {false, 0b011000011110},
      {false, 0b111110000110},
      {false, 0b011011011011},
      {false, 0b010001000100},
      {false, 0b110111010010},
      {false, 0b001110010100},
      {false, 0b001001011010},
      {false, 0b010111100011},
      {false, 0b110110110101},
      {false, 0b110101000101},
      {false, 0b001011100011},
      {false, 0b001111010110},
      {false, 0b110111011000},
      {false, 0b110001011110},
      {false, 0b011101000001},
      {false, 0b101111100000},
      {false, 0b110001101110},
      {false, 0b010101101100},
      {false, 0b010010100010},
      {false, 0b000111101010},
      {false, 0b010000001010},
      {false, 0b011001000010},
      {false, 0b100000010110},
      {false, 0b111101010010},
      {false, 0b111011001011},
      {false, 0b000010100010},
      {false, 0b011111111001},
      {false, 0b111001001011},
      {false, 0b101001111010},
      {false, 0b110100000001},
      {false, 0b010010101111},
      {false, 0b110011111001},
      {false, 0b110111100110},
      {false, 0b100111001111},
      {false, 0b100101101001},
      {false, 0b011111100100},
      {false, 0b011111011011},
      {false, 0b111100101101},
      {false, 0b110010000111},
      {false, 0b110110010000},
      {false, 0b011101111011},
      {false, 0b001101101000},
      {false, 0b001001100110},
      {false, 0b110001101000},
      {false, 0b111100101110},
      {false, 0b000101110111},
      {false, 0b011110101111},
      {false, 0b000100010010},
      {false, 0b011010000011},
      {false, 0b010010100001},
      {false, 0b111001111110},
      {false, 0b001111101010},
      {false, 0b101110100011},
      {false, 0b100111111001},
      {false, 0b110110011010},
      {false, 0b000100001000},
      {false, 0b111011010010},
      {false, 0b011001101110},
      {false, 0b001011011010},
      {false, 0b101110111100},
      {false, 0b110011010110},
      {false, 0b001010100011},
      {false, 0b111010111110},
      {false, 0b011100010011},
      {false, 0b100011010100},
      {false, 0b110000111010},
      {false, 0b110001010001},
      {false, 0b001111101001},
      {false, 0b010011100111},
      {false, 0b101010111010},
      {false, 0b110101001101},
      {false, 0b000100111000},
      {false, 0b100101001001},
      {false, 0b101110111011},
      {false, 0b001110011000},
      {false, 0b011000010010},
      {false, 0b001000010001},
      {false, 0b000111011101},
      {false, 0b100000111100},
      {false, 0b001110000100},
      {false, 0b011111111100},
      {false, 0b000100100100},
      {false, 0b100101001000},
      {false, 0b100011011110},
      {false, 0b011110100010},
      {false, 0b011110111110},
      {false, 0b010001010110},
      {false, 0b000101000000},
      {false, 0b001001100000},
      {false, 0b010001101100},
      {false, 0b110010110101},
      {false, 0b100001000010},
      {false, 0b100001001001},
      {false, 0b000111000011},
      {false, 0b111000100010},
      {false, 0b000000011101},
      {false, 0b111111000110},
      {false, 0b100111100100},
      {false, 0b111100011101},
      {false, 0b101011110011},
      {false, 0b001010110101},
      {false, 0b100000000110},
      {false, 0b111100011001},
      {false, 0b010110010010},
      {false, 0b000010010010},
      {false, 0b001011111001},
      {false, 0b001000011100},
      {false, 0b011000011000},
      {false, 0b111111110000},
      {false, 0b100001110010},
      {false, 0b011011110010},
      {false, 0b000110011101},
      {false, 0b001101001010},
      {false, 0b011010100111},
      {false, 0b100000011100},
      {false, 0b001000111011},
      {false, 0b011010100110},
      {false, 0b000001111111},
      {false, 0b001010010111},
      {false, 0b011100001010},
      {false, 0b110110001000},
      {false, 0b110010101111},
      {false, 0b111100010111},
      {false, 0b100001111010},
      {false, 0b101110010110},
      {false, 0b000010110011},
      {false, 0b111001010100},
      {false, 0b101101110110},
      {false, 0b111111111100},
      {false, 0b011101101011},
      {false, 0b011011110100},
      {false, 0b111010100011},
      {false, 0b001101000110},
      {false, 0b111101111001},
      {false, 0b110001111000},
      {false, 0b010110000111},
      {false, 0b110110100101},
      {false, 0b111101011100},
      {false, 0b100001000011},
      {false, 0b010011101000},
      {false, 0b000111110000},
      {false, 0b111011110100},
      {false, 0b011010111110},
      {false, 0b101011001000},
      {false, 0b111100110101},
      {false, 0b100100001001},
      {false, 0b100011110100},
      {false, 0b010101010011},
      {false, 0b010110011011},
      {false, 0b100111001101},
      {false, 0b000111001010},
      {false, 0b110111011011},
      {false, 0b100000111011},
      {false, 0b111011000001},
      {false, 0b011111100011},
      {false, 0b110010000010},
      {false, 0b100110101111},
      {false, 0b101001111000},
      {false, 0b111001111010},
      {false, 0b000111111000},
      {false, 0b111110100100},
      {false, 0b111001111011},
      {false, 0b100010110111},
      {false, 0b110111001111},
      {false, 0b100011001001},
      {false, 0b110011001101},
      {false, 0b100011101111},
      {false, 0b011011110000},
      {false, 0b101100011110},
      {false, 0b110110111011},
      {false, 0b011010100000},
      {false, 0b111000000010},
      {false, 0b000010010011},
      {false, 0b110101101001},
      {false, 0b101011011101},
      {false, 0b011101100110},
      {false, 0b111111000010},
      {false, 0b010110100101},
      {false, 0b010010011110},
      {false, 0b010000101111},
      {false, 0b010110101001},
      {false, 0b001111010101},
      {false, 0b111000101110},
      {false, 0b100000010111},
      {false, 0b111001000101},
      {false, 0b111101101100},
      {false, 0b011000000110},
      {false, 0b000001110010},
      {false, 0b110011010001},
      {false, 0b011110011011},
      {false, 0b100000010001},
      {false, 0b000100100001},
      {false, 0b011110001100},
      {false, 0b001101011111},
      {false, 0b100000000001},
      {false, 0b000010011001},
      {false, 0b110111000110},
      {false, 0b100110110111},
      {false, 0b011000110000},
      {false, 0b100101000101},
      {false, 0b100100111110},
      {false, 0b000101010100},
      {false, 0b001110100111},
      {false, 0b111011001010},
      {false, 0b010111001001},
      {false, 0b110101001110},
      {false, 0b111000100111},
      {false, 0b000101011100},
      {false, 0b100010111000},
      {false, 0b000111110111},
      {false, 0b010110010100},
      {false, 0b110101100100},
      {false, 0b111000011111},
      {false, 0b000101001100},
      {false, 0b000001011111},
      {false, 0b011001111101},
      {false, 0b110001111001},
      {false, 0b111111110100},
      {false, 0b010100111111},
      {false, 0b011001100110},
      {false, 0b010110101101},
      {false, 0b011111011001},
      {false, 0b101000010100},
      {false, 0b010001100101},
      {false, 0b101000100101},
      {false, 0b001001010010},
      {false, 0b000100011000},
      {false, 0b000000000111},
      {false, 0b001110011001},
      {false, 0b100000001011},
      {false, 0b011011101001},
      {false, 0b111001000000},
      {false, 0b110011100000},
      {false, 0b011001100011},
      {false, 0b000010011100},
      {false, 0b000111000000},
      {false, 0b000110011111},
      {false, 0b010100011101},
      {false, 0b001100010111},
      {false, 0b100011000001},
      {false, 0b001011000110},
      {false, 0b010000011111},
      {false, 0b011101001100},
      {false, 0b101111011110},
      {false, 0b000101001001},
      {false, 0b110100101100},
      {false, 0b000100010101},
      {false, 0b010011001000},
      {false, 0b010000010100},
      {false, 0b111111010000},
      {false, 0b000101000111},
      {false, 0b000010010110},
      {false, 0b001010000001},
      {false, 0b100110110010},
      {false, 0b010101100010},
      {false, 0b111110010100},
      {false, 0b111011111110},
      {false, 0b010110110101},
      {false, 0b011111000011},
      {false, 0b001001001000},
      {false, 0b101100001101},
      {false, 0b100010101001},
      {false, 0b010001101011},
      {false, 0b000011011101},
      {false, 0b010110011111},
      {false, 0b101001001010},
      {false, 0b100100001111},
      {false, 0b100110100011},
      {false, 0b000101001010},
      {false, 0b100000100101},
      {false, 0b011000100110},
      {false, 0b110100000110},
      {false, 0b000000010101},
      {false, 0b000011110010},
      {false, 0b100010010101},
      {false, 0b001000100111},
      {false, 0b111010000101},
      {false, 0b000011000010},
      {false, 0b000101001110},
      {false, 0b000100110000},
      {false, 0b101110010001},
      {false, 0b101110100100},
      {false, 0b111111001101},
      {false, 0b111011101110},
      {false, 0b010011000100},
      {false, 0b000001001000},
      {false, 0b100010111110},
      {false, 0b111100101001},
      {false, 0b001011111101},
      {false, 0b000110000011},
      {false, 0b100111111100},
      {false, 0b111000000110},
      {false, 0b001001011110},
      {false, 0b111011110000},
      {false, 0b110110000110},
      {false, 0b110110011100},
      {false, 0b010111111010},
      {false, 0b011011001110},
      {false, 0b110110001100},
      {false, 0b000111100010},
      {false, 0b011001100101},
      {false, 0b111111000011},
      {false, 0b011001111000},
      {false, 0b110111010100},
      {false, 0b000011111010},
      {false, 0b011111101001},
      {false, 0b011001011010},
      {false, 0b010111101101},
      {false, 0b001100100110},
      {false, 0b001110101100},
      {false, 0b001011011111},
      {false, 0b000110001010},
      {false, 0b100100001101},
      {false, 0b011001101111},
      {false, 0b010000100110},
      {false, 0b110110010100},
      {false, 0b000000110010},
      {false, 0b011000101101},
      {false, 0b110101111011},
      {false, 0b110011111011},
      {false, 0b010010001000},
      {false, 0b001101110000},
      {false, 0b100111100000},
      {false, 0b111001011100},
      {false, 0b001000110010},
      {false, 0b011000011100},
      {false, 0b001110010111},
      {false, 0b010111011101},
      {false, 0b010001110001},
      {false, 0b111111101110},
      {false, 0b000010111000},
      {false, 0b001001000110},
      {false, 0b101101100010},
      {false, 0b000010000000},
      {false, 0b111100100100},
      {false, 0b101111011010},
      {false, 0b111110011111},
      {false, 0b010011110100},
      {false, 0b010010010001},
      {false, 0b011100011101},
      {false, 0b111100000100},
      {false, 0b011110011000},
      {false, 0b000101100000},
      {false, 0b101000111100},
      {false, 0b101011110001},
      {false, 0b001010000100},
      {false, 0b001100101110},
      {false, 0b010101010101},
      {false, 0b111101110010},
      {false, 0b011110100100},
      {false, 0b001101100000},
      {false, 0b000000110011},
      {false, 0b100101100000},
      {false, 0b101111100011},
      {false, 0b101010101001},
      {false, 0b100110110011},
      {false, 0b000110100010},
      {false, 0b101010000100},
      {false, 0b001011010011},
      {false, 0b010100110101},
      {false, 0b000011101101},
      {false, 0b100001001100},
      {false, 0b111101101110},
      {false, 0b100111101001},
      {false, 0b010110111010},
      {false, 0b011110000110},
      {false, 0b100101011101},
      {false, 0b000000001000},
      {false, 0b000111001011},
      {false, 0b011001000101},
      {false, 0b011101001111},
      {false, 0b111010001011},
      {false, 0b010011011111},
      {false, 0b101100001011},
      {false, 0b001110110001},
      {false, 0b101110110100},
      {false, 0b100100011000},
      {false, 0b000111010111},
      {false, 0b111011111011},
      {false, 0b011011100111},
      {false, 0b110000110010},
      {false, 0b101110110000},
      {false, 0b010001111011},
      {false, 0b010011111100},
      {false, 0b110100110011},
      {false, 0b011000111110},
      {false, 0b000010111010},
      {false, 0b001110001001},
      {false, 0b011001100000},
      {false, 0b100100100110},
      {false, 0b011111001010},
      {false, 0b000101000100},
      {false, 0b101001010010},
      {false, 0b010011101100},
      {false, 0b110100101110},
      {false, 0b010110001001},
      {false, 0b111000011011},
      {false, 0b010001110000},
      {false, 0b011111011000},
      {false, 0b010011000011},
      {false, 0b001100001010},
      {false, 0b100011100010},
      {false, 0b011011111100},
      {false, 0b010110101111},
      {false, 0b000101100001},
      {false, 0b101101100000},
      {false, 0b111000110101},
      {false, 0b110011010100},
      {false, 0b000111011010},
      {false, 0b011111010010},
      {false, 0b111011111000},
      {false, 0b100101110111},
      {false, 0b000000111111},
      {false, 0b011100110010},
      {false, 0b110110011011},
      {false, 0b010001011101},
      {false, 0b100110110000},
      {false, 0b110111110010},
      {false, 0b010001111101},
      {false, 0b100001101001},
      {false, 0b110000111111},
      {false, 0b010111110000},
      {false, 0b100011001000},
      {false, 0b011000101111},
      {false, 0b111100100101},
      {false, 0b010111010010},
      {false, 0b111100110110},
      {false, 0b101001100010},
      {false, 0b110100010000},
      {false, 0b110010111000},
      {false, 0b011100010010},
      {false, 0b000000001001},
      {false, 0b010100011110},
      {false, 0b110101010110},
      {false, 0b111100100001},
      {false, 0b111000010010},
      {false, 0b110000010111},
      {false, 0b001011100000},
      {false, 0b001001010101},
      {false, 0b110101101111},
      {false, 0b001010010101},
      {false, 0b010000110100},
      {false, 0b111001011010},
      {false, 0b000001111100},
      {false, 0b101101011111},
      {false, 0b110100111011},
      {false, 0b100111010000},
      {false, 0b110001110100},
      {false, 0b101011000110},
      {false, 0b101100111110},
      {false, 0b001010010001},
      {false, 0b011111101011},
      {false, 0b010100001001},
      {false, 0b010110100001},
      {false, 0b000000110000},
      {false, 0b110010111111},
      {false, 0b111010000100},
      {false, 0b111100001111},
      {false, 0b100100110000},
      {false, 0b001000110001},
      {false, 0b011010001011},
      {false, 0b110101111010},
      {false, 0b001110000001},
      {false, 0b000010100110},
      {false, 0b010101111010},
      {false, 0b011110100101},
      {false, 0b011011100100},
      {false, 0b000000011111},
      {false, 0b100010011001},
      {false, 0b100101000100},
      {false, 0b110010011011},
      {false, 0b011000000000},
      {false, 0b001111111110},
      {false, 0b001111010011},
      {false, 0b100000110111},
      {false, 0b100011011000},
      {false, 0b110011111110},
      {false, 0b010001000001},
      {false, 0b011100011111},
      {false, 0b101110001000},
      {false, 0b101110000111},
      {false, 0b001101100011},
      {false, 0b111100100000},
      {false, 0b101001110010},
      {false, 0b100011110110},
      {false, 0b100110101101},
      {false, 0b011101100100},
      {false, 0b111001011110},
      {false, 0b110001101101},
      {false, 0b100101101110},
      {false, 0b111101001100},
      {false, 0b100100100001},
      {false, 0b100000011110},
      {false, 0b000000000011},
      {false, 0b010100010111},
      {false, 0b001010010110},
      {false, 0b110010110000},
      {false, 0b100011110101},
      {false, 0b110110110110},
      {false, 0b100101101100},
      {false, 0b000111011011},
      {false, 0b001001001011},
      {false, 0b101111010010},
      {false, 0b011011010111},
      {false, 0b010001100001},
      {false, 0b111110101100},
      {false, 0b010100100010},
      {false, 0b001101101111},
      {false, 0b011111100001},
      {false, 0b100011011111},
      {false, 0b110011111100},
      {false, 0b100110001110},
      {false, 0b101010100000},
      {false, 0b100111011010},
      {false, 0b101110101001},
      {false, 0b101111001011},
      {false, 0b110111000010},
      {false, 0b100110001001},
      {false, 0b000011111101},
      {false, 0b110100010011},
      {false, 0b101001000010},
      {false, 0b101101011100},
      {false, 0b001110010010},
      {false, 0b001111000010},
      {false, 0b110011101110},
      {false, 0b001010011000},
      {false, 0b011001000011},
      {false, 0b110001101111},
      {false, 0b001011001011},
      {false, 0b011001111111},
      {false, 0b000101010101},
      {false, 0b101101100110},
      {false, 0b110100101101},
      {false, 0b011000111000},
      {false, 0b011110100011},
      {false, 0b010101110111},
      {false, 0b110010001000},
      {false, 0b101110100010},
      {false, 0b111010001010},
      {false, 0b011000001010},
      {false, 0b001010110111},
      {false, 0b110011111111},
      {false, 0b011111101010},
      {false, 0b000101110000},
      {false, 0b101101000001},
      {false, 0b111110111001},
      {false, 0b110010111011},
      {false, 0b100111101111},
      {false, 0b101111000100},
      {false, 0b011101110000},
      {false, 0b001101010010},
      {false, 0b110110011101},
      {false, 0b000110000001},
      {false, 0b001011111011},
      {false, 0b011100001111},
      {false, 0b110010101100},
      {false, 0b110010010100},
      {false, 0b110010100000},
      {false, 0b110110000100},
      {false, 0b010110011001},
      {false, 0b100101101101},
      {false, 0b010010010101},
      {false, 0b101011111000},
      {false, 0b100001001000},
      {false, 0b011100011110},
      {false, 0b101110010011},
      {false, 0b110110001010},
      {false, 0b110010110001},
      {false, 0b110000000100},
      {false, 0b011000000011},
      {false, 0b000011111000},
      {false, 0b010111000111},
      {false, 0b000111000100},
      {false, 0b111101100100},
      {false, 0b101000101111},
      {false, 0b001000000110},
      {false, 0b000100000001},
      {false, 0b101001100101},
      {false, 0b001001111110},
      {false, 0b001000010011},
      {false, 0b111100001110},
      {false, 0b001010111011},
      {false, 0b011110011101},
      {false, 0b001111101000},
      {false, 0b000001110100},
      {false, 0b110101000110},
      {false, 0b000101000010},
      {false, 0b001110101010},
      {false, 0b101101011101},
      {false, 0b011100101001},
      {false, 0b011110000000},
      {false, 0b001001101011},
      {false, 0b001001011111},
      {false, 0b011101111101},
      {false, 0b101111100111},
      {false, 0b001110110110},
      {false, 0b011010110001},
      {false, 0b011111000001},
      {false, 0b000100101101},
      {false, 0b001010010011},
      {false, 0b010010110000},
      {false, 0b111011101111},
      {false, 0b110110000111},
      {false, 0b001011110101},
      {false, 0b100001101011},
      {false, 0b110101100000},
      {false, 0b010011111101},
      {false, 0b000101110010},
      {false, 0b100100111010},
      {false, 0b101101101111},
      {false, 0b010110111001},
      {false, 0b110100110110},
      {false, 0b111111001111},
      {false, 0b100110010000},
      {false, 0b100010100000},
      {false, 0b011001101000},
      {false, 0b000000111010},
      {false, 0b010001100000},
      {false, 0b000011001101},
      {false, 0b111100011111},
      {false, 0b100010111011},
      {false, 0b000010100111},
      {false, 0b100101000001},
      {false, 0b011001001010},
      {false, 0b100101010001},
      {false, 0b101001001101},
      {false, 0b010011101001},
      {false, 0b000001000101},
      {false, 0b000010011000},
      {false, 0b111011100001},
      {false, 0b001100111010},
      {false, 0b010011011000},
      {false, 0b000001011101},
      {false, 0b010100111001},
      {false, 0b001010110000},
      {false, 0b011011101000},
      {false, 0b010010111011},
      {false, 0b100101100100},
      {false, 0b010111000011},
      {false, 0b001001111001},
      {false, 0b011111011110},
      {false, 0b011110111011},
      {false, 0b101010010111},
      {false, 0b101101111011},
      {false, 0b001100011101},
      {false, 0b011011010010},
      {false, 0b000011000100},
      {false, 0b010010110010},
      {false, 0b001111011110},
      {false, 0b011100011001},
      {false, 0b011011101111},
      {false, 0b010110101010},
      {false, 0b111011010000},
      {false, 0b111111010110},
      {false, 0b001100110110},
      {false, 0b010000110111},
      {false, 0b000011110100},
      {false, 0b011011000001},
      {false, 0b101100101110},
      {false, 0b100011001110},
      {false, 0b011000010100},
      {false, 0b000110001011},
      {false, 0b011000000001},
      {false, 0b000000111100},
      {false, 0b101100110101},
      {false, 0b111110010011},
      {false, 0b111110101001},
      {false, 0b110110101111},
      {false, 0b101110110101},
      {false, 0b110101111001},
      {false, 0b000010001101},
      {false, 0b111010101000},
      {false, 0b010010100101},
      {false, 0b001111101111},
      {false, 0b100110100110},
      {false, 0b000001010000},
      {false, 0b000011110101},
      {false, 0b110100111000},
      {false, 0b101010111100},
      {false, 0b000000010100},
      {false, 0b010100010101},
      {false, 0b010001100010},
      {false, 0b100011010010},
      {false, 0b011101001001},
      {false, 0b000010101111},
      {false, 0b000101000101},
      {false, 0b001001101100},
      {false, 0b111111100101},
      {false, 0b100111111010},
      {false, 0b110011101011},
      {false, 0b000011100000},
      {false, 0b111111011100},
      {false, 0b010100001010},
      {false, 0b000011100110},
      {false, 0b110011111101},
      {false, 0b001100000000},
      {false, 0b011010101111},
      {false, 0b101010101011},
      {false, 0b111011000111},
      {false, 0b010100110010},
      {false, 0b011110110101},
      {false, 0b010000011001},
      {false, 0b100011010110},
      {false, 0b000000001110},
      {false, 0b000010101101},
      {false, 0b111110100011},
      {false, 0b111110010000},
      {false, 0b101011101010},
      {false, 0b011011001101},
      {false, 0b101011111111},
      {false, 0b100101101011},
      {false, 0b111001000100},
      {false, 0b010010000101},
      {false, 0b011001010101},
      {false, 0b110001100010},
      {false, 0b010100001101},
      {false, 0b111111101101},
      {false, 0b101101000111},
      {false, 0b001110110101},
      {false, 0b001101000101},
      {false, 0b001000100110},
      {false, 0b000011011000},
      {false, 0b101001001001},
      {false, 0b010001001000},
      {false, 0b110110111010},
      {false, 0b111110011100},
      {false, 0b000111111100},
      {false, 0b000110101111},
      {false, 0b000001110001},
      {false, 0b011101101010},
      {false, 0b100001001101},
      {false, 0b010100010011},
      {false, 0b001001001110},
      {false, 0b111110110101},
      {false, 0b001110001011},
      {false, 0b111010101110},
      {false, 0b100111000000},
      {false, 0b110100000010},
      {false, 0b000010111110},
      {false, 0b100100000100},
      {false, 0b111111001000},
      {false, 0b111010001000},
      {false, 0b101011100111},
      {false, 0b001111111100},
      {false, 0b001001101110},
      {false, 0b011000001111},
      {false, 0b001001100001},
      {false, 0b001110000110},
      {false, 0b111011011011},
      {false, 0b001010101111},
      {false, 0b101110110110},
      {false, 0b110010000110},
      {false, 0b001100010100},
      {false, 0b110100111001},
      {false, 0b111111110110},
      {false, 0b100011001011},
      {false, 0b111111000101},
      {false, 0b000111010010},
      {false, 0b010100100110},
      {false, 0b101010110110},
      {false, 0b011110110100},
      {false, 0b110110101100},
      {false, 0b100100111111},
      {false, 0b101101110100},
      {false, 0b010110101110},
      {false, 0b101001101101},
      {false, 0b001101010011},
      {false, 0b001000100101},
      {false, 0b010111010011},
      {false, 0b000011110011},
      {false, 0b010011111111},
      {false, 0b101000000110},
      {false, 0b010001111110},
      {false, 0b100111010010},
      {false, 0b010100010100},
      {false, 0b110100001111},
      {false, 0b001100000001},
      {false, 0b010010110110},
      {false, 0b011010011011},
      {false, 0b101000010001},
      {false, 0b101100010110},
      {false, 0b111010011000},
      {false, 0b001001101111},
      {false, 0b111101010001},
      {false, 0b010101111111},
      {false, 0b000111010110},
      {false, 0b010111100100},
      {false, 0b000111101111},
      {false, 0b110010100001},
      {false, 0b100101111100},
      {false, 0b010010010011},
      {false, 0b100100001000},
      {false, 0b010110000001},
      {false, 0b000011000110},
      {false, 0b101100110100},
      {false, 0b000001100101},
      {false, 0b010110101000},
      {false, 0b101010100010},
      {false, 0b101001110000},
      {false, 0b101111000001},
      {false, 0b110001111110},
      {false, 0b101011010101},
      {false, 0b111000010001},
      {false, 0b010000101101},
      {false, 0b000101010011},
      {false, 0b101100011100},
      {false, 0b010101000000},
      {false, 0b010001110010},
      {false, 0b111000001010},
      {false, 0b101001011100},
      {false, 0b001101111101},
      {false, 0b111000101011},
      {false, 0b100100000000},
      {false, 0b010001011111},
      {false, 0b000101000011},
      {false, 0b111000011000},
      {false, 0b000000100101},
      {false, 0b110100001010},
      {false, 0b011111111101},
      {false, 0b100001010100},
      {false, 0b110000011000},
      {false, 0b011110011100},
      {false, 0b000000110110},
      {false, 0b101100100101},
      {false, 0b000110001110},
      {false, 0b110101110100},
      {false, 0b010011111011},
      {false, 0b101011100110},
      {false, 0b110110010101},
      {false, 0b001110011100},
      {false, 0b110101110000},
      {false, 0b111001001111},
      {false, 0b000010101011},
      {false, 0b010011100001},
      {false, 0b100101010111},
      {false, 0b000111100101},
      {false, 0b000011001110},
      {false, 0b111001000111},
      {false, 0b011001100100},
      {false, 0b001110001101},
      {false, 0b110101010100},
      {false, 0b100101100111},
      {false, 0b011001000000},
      {false, 0b100000110100},
      {false, 0b100011101101},
      {false, 0b100100110101},
      {false, 0b011000110110},
      {false, 0b101110011011},
      {false, 0b110101100001},
  };

  bit_array_t arr = {
      .no_bits = 12,
      .mask = 0b111111111111,
      .len = COUNT_OF(diagnostics),
      .count = COUNT_OF(diagnostics)};

  assert(arr.len <= COUNT_OF(arr.entries));

  memcpy(arr.entries, diagnostics, sizeof(diagnostics));

  return arr;
}

void part_01(void) {
  bit_array_t bit_arr = create_bit_array();

  uint16_t gamma_rate = 0;
  for (int i = 0; i < bit_arr.no_bits; i++) {
    int bit_col = bit_arr.no_bits - i - 1;
    int one_count = 0;
    int zero_count = 0;

    for (int n = 0; n < bit_arr.len; n++) {
      if (bit_arr.entries[n].value & (1 << bit_col)) {
        one_count++;
      } else {
        zero_count++;
      }
    }

    assert(one_count != zero_count);

    if (one_count > zero_count) {
      gamma_rate |= (1 << bit_col);
    }
  }

  uint16_t epsilon_rate = bit_arr.mask & (~gamma_rate);

  printf("Part 01 Result: %d\n", gamma_rate * epsilon_rate);
}

enum {
  MOST_COMMON,
  LEAST_COMMON,
};

typedef uint32_t keep_type_e;

int calc_rating(bit_array_t *bit_arr, keep_type_e keep_type) {
  int result = 0;
  for (int i = 0; i < bit_arr->no_bits; i++) {
    int bit_col = bit_arr->no_bits - i - 1;
    int one_count = 0;
    int zero_count = 0;

    for (int n = 0; n < bit_arr->len; n++) {
      if (bit_arr->entries[n].removed) {
        continue;
      }

      if (bit_arr->entries[n].value & (1 << bit_col)) {
        one_count++;
      } else {
        zero_count++;
      }
    }

    int num_to_keep;
    if (keep_type == MOST_COMMON) {
      num_to_keep = one_count >= zero_count ? 1 : 0;
    } else {
      num_to_keep = zero_count <= one_count ? 0 : 1;
    }

    for (int n = 0; n < bit_arr->len; n++) {
      if (bit_arr->entries[n].removed) {
        continue;
      }

      int bit = bit_arr->entries[n].value & (1 << bit_col) ? 1 : 0;
      if (bit != num_to_keep) {
        assert(bit_arr->entries[n].removed == false);
        bit_arr->entries[n].removed = true;
        bit_arr->count--;
      }
    }

    if (bit_arr->count == 1) {
      break;
    }
  }

  assert(bit_arr->count == 1);
  for (int n = 0; n < bit_arr->len; n++) {
    if (!bit_arr->entries[n].removed) {
      result = bit_arr->entries[n].value;
      break;
    }
  }

  assert(result != 0);
  return result;
}

void part_02(void) {
  bit_array_t bit_arr = create_bit_array();
  int oxygen_generator_rating = calc_rating(&bit_arr, MOST_COMMON);

  bit_arr = create_bit_array();
  int c02_scrubber_rating = calc_rating(&bit_arr, LEAST_COMMON);

  printf("Part 02 Result: %d\n", oxygen_generator_rating * c02_scrubber_rating);
}

int main(void) {
  part_01();
  part_02();

  return 0;
}
